#Place Image with ![Caption](path)

---
title: "Analysis of Insurance Cost on Patient Demographics"
author: "[Daksh Verma, Evan Patel, Maxine Attobrah, Saurabh Rane, Sujay Shah, Tejas Dighe]"
date: "May 8, 2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Abstract

Health insurance is of utmost importance in the United States, especially the cost of health insurance across age groups. We try to understand the factors affecting the cost of health insurance and if they can be used to predict the future costs of insurance, which could potentially help people plan better for their future health insurance costs. Here, we predict the cost of health insurance based on the smoking status, age, and body-mass-index (BMI) of individuals across age groups of 18-90 years. When we built models to predict the cost for health insurance, it was seen that smoking status, age, and BMI turned out to be the biggest influential factor in determining the cost, irrespective of the geographical location in the United States. While we believed gender would play a big role, it was seen that age and BMI are more influential in helping predict the cost of insurance. Therefore, we believe our analysis will help understand the factors driving costs for insurance in a data-driven approach. We take the data-driven approach and scrutinize it from a public policy perspective because in the growing age of digital interventions, it is important to understand biases and limitations of data science. Especially in fields like healthcare where policy decisions can affect millions of people, it is imperative for policy makers to be cognizant of the checks and balances required while using data science. Finally, understanding factors that influence the cost of health insurance across age groups can potentially help create the right awareness material based on evidence and therefore help mitigate risks, modify behavior, and eventually reduce the cost of healthcare insurance for the future across all age groups and populations.

# Introduction

## Use of data science and machine learning in healthcare and public policy
Data Science and Machine Learning are emerging technologies that have been widely used and applied across various products and industries, especially in healthcare. It can play a huge role in industries like finance and life sciences owing to its capability of discovering patterns across large datasets^1^. Data science and machine learning have been used in drug discovery, to predict diseases, decision support, and predicting rates of readmission in hospitals, amongst other applications in healthcare^2^. Data science and machine learning has also been used in diverse policy perspectives. They have been used to predicting crime risks, healthcare violations, and most effective interventions^3,4^.

There has been massive clinical data being available due to the digitalization of medical records. Therefore, we have seen an influx of data science interventions in medicine, particularly to gain insights and knowledge for decision making. However, there are multiple challenges with using data science in healthcare. In an example of using ICU data, where there is a crucial need of evidence based case management in complex illnesses, data science can help make decisions for better patient outcomes. Despite an increase in the number of publications and studies, very few projects have actually been implemented in the ICU ecosystem^5^. In addition, when data science and machine learning are used to bring policy changes, it can present a whole new set of challenges and benefits. For example, it could induce a strategic shift in behavior. If our models can identify which factors most influence a certain decision, the user or individual could modify their decisions or actions to attain maximum benefit. This could be beneficial in sectors like healthcare, one could change their lifestyle in order to attain a longer life span or reduced out of pocket expenditure. However, in sectors like crime, it would be detrimental as people could change and manipulate signals^6^ on factors that classify them as potential criminals or high-risk individuals. Another big challenge using data science for predictions is the inherent inclusion of human biases which manifest as systemic gaps. The datasets can induce a bias within the algorithm depending on how the data was collected and for what purpose it was utilized. Finally, it’s not always possible or easy to implement the results that a model provides the user. It could be difficult or impossible to implement certain interventions due to political circumstances, financial constraints, or personal perspectives of key decision makers^7^. This makes the application of data science, especially in the field of healthcare insurance, very important but tricky.

## Health insurance in the United states: Coverage and factors affecting costs

Health insurance is the mechanism for an individual to pay for their healthcare expenses. Most of the population have private insurance through their workplace or employer, but others could also obtain it through the state or the federal government^9^. Every year, the coverage and rates of health insurance are subject to change based on the economy, population demography change, and policies around healthcare^9^. COVID-19 put forward an unprecedented governance challenge, especially for healthcare and insurance.  In the United states where healthcare insurance plays a big role in access to healthcare, the federal government and state governments had fragmented decisions[8]. Pre COVID-19, in 2019, roughly ~27.5 million people in the US did not have health insurance- that’s nearly 8.5% of the US population. There was obviously a heavy skew towards private healthcare insurance users with over ~67% people falling in that bucket, since employer based health insurance is the most popular form of insurance in the US. Government programs like ‘Medicaid’ or ‘Medicare’ covered ~33% of the population^10^. 

There are multiple factors that affect the premium costs for healthcare insurance. There are multiple factors that can determine the cost^11^. State and federal laws can dictate what the insurance can and cannot cover or charge. The state of residence can also cause a variance in the costing of insurance. In addition, premiums tend to be lower in urban areas and also it depends from county to county. The type of insurance that an individual buys also determines how much they pay or if the employer's group plan covers a section of the healthcare insurance cost. Moreover, the insurance comes large at scale and therefore is cheaper for large companies. The income level has a big role in the insurance cost, for example the low wage workers tend to pay less through federal or state as they receive subsidies. There are also multiple plans which come across different price ranges. Finally, age and smoking plays an extensive role determining the price of health insurance. For example, the rates hike up with age, and the premium for tobacco users can cost upwards of 50% than non-smokers^12^. There are certain factors that cannot affect the healthcare insurance costs like gender, as insurance companies aren’t allowed to charge men and women differently for the same plans^12^. 

## Motivation
The ACA (Affordable Care Act) was created in 2010 and is known as ‘Obamacare’ which extends to millions of people. However, the ACA also made healthcare insurance mandatory^13^.  
As of 2020, the average cost of health insurance in the US was $456 per month for a single person and $1152 per month for a family^14^. While there are multiple factors affecting the costs of insurance plans, these prices are high for a big section of the population. Moreover, the most vulnerable populations are most affected by the prices of the insurance premiums. In the US, ~37.2 million people were in poverty in 2020, which was ~3.3 million more than 2019[15]. Similar patterns were observed for age groups under 18, where poverty rates jumped from 14.4% to 16.1% from 2019 to 2020. For the age ranges of 18-64 years, the poverty rates went from 9.4% to 10.4% in 2020, and for people above 65 years of age, it was stagnant at 9.0%. There was a significant change in the poverty levels for Hispanics and Blacks (19.5%)^15^. Therefore, in this paper we wish to explore the various factors that have the highest influence on the cost of healthcare insurance premiums through various modeling efforts and also predict healthcare costs. Through this paper we hope to uncover new correlations or confirm existing beliefs regarding factors that might be in an individual's control to minimize healthcare insurance costs.

# Data
## Information on the dataset
This data is called the ‘​​Medical Cost Personal Datasets’ and the paper uses this publicly available dataset to build models.  The data for this paper was obtained from a website called www.kaggle.com which primarily hosts multiple data-sets across all domains including healthcare, finance, manufacturing, and agriculture, amongst others. The dataset is also associated with a book called ‘Machine Learning by R’ written by Brett Lantz. It seems that Packt Publishing used this dataset or similar dataset for teaching or conducting experiments. The dataset is small in size with only ~1339 rows, seems fairly straightforward, and needs cleaning and pre-processing. Exhibit 1 is a table that contains the columns along with their brief descriptions.

### Exhibit 1: Columns from the ‘Medical Cost Personal Datasets’ dataset.

```{r, results = "hide", message = FALSE, warning = FALSE, cache = TRUE, echo = FALSE}
#library(tidyverse)
#filename1 <- "https://docs.google.com/spreadsheets/d/1Kh9leQGqszJeRZEUSdhbbCsCq7xfLyJD/edit?usp=sharing&ouid=106115502650741087784&rtpof=true&sd=true"
#(dataset_details <- read_csv(file = filename1, n_max = (8)))



```

## Cleaning and transformation
The dataset we chose was already cleaned and transformed into rows of data with the columns above. There was no missing data, which was useful for utilizing all of the dataset.

## Exploratory data analysis
We explored the data to see if we can find  any biases in the data.

1. We first analyzed the age of people in the dataset. This dataset contains young and old ages. There are more younger people in this dataset.
2. Most people in this dataset do not smoke.
3. There are about the same amount of men and women.

### Line Plot
4. From the plot we notice that as a person gets older the more likely they are to have to pay more in insurance regardless of their gender. 
#graph

### Scatter Plot
5. From this scatter  plot we can see that it is not clear whether the sex of an individual affects the cost of insurance. It seems that from this graph gender may not play a role in the cost of medical insurance.  Some further analysis is needed.
#graph

### Bar Plot
6. From this plot it seems that men pay higher in insurance most times

### Histograms Based on Gender
7. The histograms for both men and women are both skewed to the right. This means that the majority of the people in the dataset are paying lower insurance costs. 
#graph
After taking the log transformation of the data we can clearly see that after about 9.6 there is a small amount of people paying higher insurance costs which is skewing the original data to the right. 

### EDA needs to be edited in the file.


# Methods
## Research Questions and Preliminary Hypotheses
Based on the research data and the data set we obtained, we analyzed the factors that may affect the insurance charges. We hypothesized 3 prominent and most probable factors (gender, age, and preconditions such as body mass index (BMI) and smoking habits) that have chances of effects on the insurance prices. We also hypothesized that the number of children and demographics do not impact the medical insurance charges. The data does not show much variation with respect to changing demographics. And the data is insufficient to analyze the variation in insurance prices based on the number of children. Therefore, based on all these factors, we came up with the following questions to conduct the research:

1. Can average insurance prices be predicted based on gender, age, BMI, and smoking habits?
2. Does gender play a role in the cost of medical insurance?

# Models
## Choice of models based on regression
### Linear Regression Model using OLS:
We wanted to see if there is a linear relationship between our independent variables (age, bmi and smoker) and our dependent variable (charges)  so we decided to use a linear regression model. 

A linear regression model makes 5 assumptions which are the Gauss Markov assumptions. These assumptions are:

1. Linearity: The relationship between the dependent variable and independent variable is linear
2. Non-colinearity: The dependent variables are independent of each other
3. Homoscedasticity: There is not a huge change for each error of the independent variables
4. Random sampling: The data is randomly sampled
5. Exogeneity: Regressors are not correlated with the error term

### Random Forest:
The second model chosen was a random forest regression model to predict the insurance charges based on a select subset of features in the dataset. Random forest is a type of ensemble method that combines multiple decision trees that uses a technique called bagging to use random subsets of features at each decision node on each tree, then combines the results to predict regression values. Random forest models are useful because the volume of uncorrelated models helps reduce variance by avoiding overfitting training data. A random forest model can help better understand which variable(s) are best to split on first and which variables are good predictors only after another variable is determined.

## Expected Model Performance
### In terms of OLS and the Gauss Markov conditions:

Linearity: We can not test that the independent variables and the dependent have a  linear relationship. However, we believe that it is reasonable to assume that these parameters will have a linear relationship

* Random sampling: There is no information on data that states whether the data was randomly sampled. 
* Non-colinearity: From our correlation matrix we did not see a huge correlation between any of the dependent variables.There could be some omitted variables that could affect some of the predictor variables but the cost of insurance and vice versa.
* Homoscedasticity: We assume that there is no huge change in error for each predictor variable

### Random Forest
Using an ensemble method like random forest is expected to produce a low MSE due to a concentrated subset of features to predict insurance cost. In addition, the choice to perform k-cross validation on different hyperparameter values is expected to further improve the model by determining the number of decision trees and the number of variables to split on at each level in the model. It’s expected that selecting the right hyperparameters will lower the Mean Squared Error while predicting the insurance cost for the test dataset.

#Results
## Summary of Models
### OLS:
To prevent the curve from increasing too much (causing over fitting), the OLS was tested with different proportions of training/test. The optimal ratio was 60:40. The linear regression resulted in coefficients on BMI, Smoker, and Age of 341, 23419, and 268 respectively. The MSE of the optimal OLS was 245449899.

### Random Forest
The training dataset was sampled pseudorandomly from the dataset and was 80% of the original dataset. To select hyperparameters, we tested the set of (100, 200, 300, 400, 500) for the number of trees in the random forest and (1, 2, 3) features compared at each decision node. For each configuration, we performed a 5-fold cross validation, trained the model on the data minus the fold and then validated on the data in the fold. From this, we calculated the MSE for each configuration and selected the hyperparameters with the lowest MSE. While the number of trees had negligible MSE differences, the best fit for our validation was consistently 2 variables compared at each decision split. For the test dataset, the number of trees selected for the model changed frequently. Included below are sample results of one run of the 5-fold cross validation. Finally, after selecting the hyperparameters the model was tested against the test dataset and our test MSE was consistently around ~0.091.

## Plots and Tables of Results
### OLS

#table

### Random Forest

#table

# Discussion
## Discussion with respect to the preliminary hypothesis
Our preliminary hypothesis was that gender would be a strong contributing factor to the cost of healthcare insurance. Literature represents that insurance companies cannot charge separately based on gender and therefore our analysis would determine if men or women are more prone to face medical issues that reflect in the healthcare insurance costing. However, our hypothesis was dismissed as gender did not turn out to be as influential and did not rank in the top three things that affected healthcare costs. Healthcare costs were mostly affected by the smoking status of the individual, followed by age, and then BMI. 

It was interesting to find BMI to be one of the influential variables because BMI is not considered to be the best indicator of good health and is only a crude measure of the health status of an individual. BMI does not account for the body fat percentage or distribution. Moreover, there is speculation that BMI ranges were determined from data from white Europeans and therefore is not generalizable to all populations. It is said that blood pressure, waist circumference, and cholesterol levels are better indicators of health status of an individual^17^. But, BMI considers the weight of an individual, which is in control of the individual and therefore is an encouraging finding for our paper. Since there is a clear correlation between obesity and illnesses and it translates to increased healthcare costs, BMI change could contribute in reducing healthcare insurance prices for an individual for the future, irrespective of their age. 

Our findings regarding age and smoking being definitive factors that affect the healthcare insurance pricing, aligns with the literature review.

## Drawbacks and Limitations
There are limitations and drawbacks of the dataset itself. First, the dataset has a low size and therefore any models built on top of it would not be dependable or representative of the population in any manner. There are four sections of the US that are all represented within roughly ~1339 rows. Moreover, the data is also skewed in the representativeness across age groups. Age groups of 18 and 19 years have ~68 and ~69 counts whereas the other age groups are between ~22 to ~30 counts. There is a good balance between the genders as men and women are equally represented in the dataset. However, there could be a difference in the data collection method, where they could have asked people their preferred gender instead of providing only two options of ‘men’ and ‘women’ because policies or business decisions have a direct effect on underrepresented communities like the transgender people^16^. Similarly, the four regions have been represented at 324 (northeast), 325 (northwest), 325(southwest), and 364 (southeast) counts. However, these samples are very small to infer anything at a larger scale and it is difficult to generalize any finding with such a small sample of people in the dataset. Finally, the dataset has not provided any information on the methodology of data collection, storage, processing, or purpose of creating this dataset. In the absence of this information it is difficult to understand the context and nature of the data. For example, if this is self reported data, it could be possible that some smokers could have answered the questions as being ‘non-smokers’ due to the stigma surrounding smoking as a habit. In such a case, the dataset would be non-dependable as the accuracy of the information would be questionable.

# Conclusion
## Policy/Business/Tech implications

## Future work and limitations
It would be interesting to explore at an older age, if BMI continues to affect the cost of healthcare insurance. Our current data analysis shows that both age and BMI play an important role in healthcare insurance pricing. However, at an early age it is clear that weight can be reduced and therefore avoid illnesses that could later cause a bump in pricing. However, at an older age, it would be interesting to find out how much BMI affects the pricing, and if it doesn’t, what factors influence the pricing. This would help understand what targeted interventions might be required for the eldery population.


```{r setup, include = TRUE, warning = FALSE, message = FALSE}

```
